<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Custom Wordle League</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }
    .input-row {
      display: flex;
      justify-content: center;
      margin: 20px 0;
      gap: 5px;
    }
    .tile {
      width: 50px;
      height: 50px;
      border: 2px solid #ccc;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      text-transform: uppercase;
      background-color: white;
      border-radius: 4px;
    }
    .tile.correct { background-color: #6aaa64; color: white; }  /* Green */
    .tile.present { background-color: #c9b458; color: white; }  /* Yellow */
    .tile.absent  { background-color: #787c7e; color: white; }  /* Grey */
  </style>
</head>
<body>
  <h1>Custom Wordle League</h1>
  <p>Type your 5-letter guess and tap "Guess":</p>

  <div class="input-row" id="inputRow">
    <div class="tile input-tile" id="tile0"></div>
    <div class="tile input-tile" id="tile1"></div>
    <div class="tile input-tile" id="tile2"></div>
    <div class="tile input-tile" id="tile3"></div>
    <div class="tile input-tile" id="tile4"></div>
  </div>

  <button onclick="submitGuess()">Guess</button>
  <div id="result"></div>

  <!-- Invisible input that grabs mobile keyboard -->
  <input id="hiddenInput" type="text" inputmode="text" autocomplete="off" autocorrect="off" autocapitalize="characters" spellcheck="false" style="opacity:0; position:absolute; top:-100px;">

  <script>
    const wordList = ["apple", "brave", "charm", "delta", "eagle", "fancy", "grape", "hound", "mango"];
    const startDate = new Date('2025-06-01');
    const today = new Date();
    const dayNumber = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
    const targetWord = wordList[dayNumber % wordList.length].toUpperCase();
    const maxGuesses = 6;
    const guesses = [];
    let currentGuess = "";

    // When user taps the tile row, focus hidden input
    document.getElementById('inputRow').addEventListener('click', function() {
      document.getElementById('hiddenInput').focus();
    });

    // When page loads, focus hidden input
    window.onload = function() {
      document.getElementById('hiddenInput').focus();
      // If already played today, show result and prevent play
      if(localStorage.getItem('wordlePlayed-' + dayNumber) === 'true') {
        document.getElementById('result').innerHTML = localStorage.getItem('wordleResult-' + dayNumber);
        document.querySelector('button').disabled = true;
      }
    };

    // Handle typing into hidden input
    document.getElementById('hiddenInput').addEventListener('input', function(e) {
      let value = e.target.value.toUpperCase();
      if (/^[A-Z]{0,5}$/.test(value)) {
        currentGuess = value;
        updateInputTiles();
      } else {
        // Disallow invalid chars
        e.target.value = currentGuess;
      }
    });

    function updateInputTiles() {
      for (let i = 0; i < 5; i++) {
        document.getElementById('tile' + i).textContent = currentGuess[i] || '';
      }
    }

    function submitGuess() {
      if (currentGuess.length !== 5) {
        alert("Guess must be 5 letters.");
        return;
      }
      guesses.push(currentGuess);
      checkGuess(currentGuess);
      currentGuess = "";
      document.getElementById('hiddenInput').value = "";
      updateInputTiles();

      if (guesses.length >= maxGuesses) endGame();
    }

    function checkGuess(guess) {
      guess = guess.toUpperCase();
      const resultRow = document.createElement('div');
      resultRow.classList.add('input-row');

      const targetLetters = targetWord.split('');
      const guessLetters = guess.split('');
      const tileStates = ['absent', 'absent', 'absent', 'absent', 'absent'];

      // First pass: correct position (green)
      for (let i = 0; i < 5; i++) {
        if (guessLetters[i] === targetLetters[i]) {
          tileStates[i] = 'correct';
          targetLetters[i] = null; // Mark this letter as used
        }
      }

      // Second pass: wrong position (yellow)
      for (let i = 0; i < 5; i++) {
        if (tileStates[i] === 'correct') continue;
        const index = targetLetters.indexOf(guessLetters[i]);
        if (index !== -1) {
          tileStates[i] = 'present';
          targetLetters[index] = null; // Mark as used
        }
      }

      // Display the tiles
      for (let i = 0; i < 5; i++) {
        const tile = document.createElement('div');
        tile.classList.add('tile', tileStates[i]);
        tile.textContent = guess[i];
        resultRow.appendChild(tile);
      }

      document.getElementById('result').appendChild(resultRow);

      if (guess === targetWord) endGame();
    }

    function endGame() {
      document.querySelector('button').disabled = true;
      document.removeEventListener('keydown', handleKeyPress);
      localStorage.setItem('wordlePlayed-' + dayNumber, 'true');
      localStorage.setItem('wordleResult-' + dayNumber, document.getElementById('result').innerHTML);
    }

    // Handle keyboard typing (PC fallback)
    document.addEventListener('keydown', handleKeyPress);
    function handleKeyPress(e) {
      if(e.key === 'Backspace') {
        currentGuess = currentGuess.slice(0, -1);
      } else if(e.key.match(/^[a-zA-Z]$/) && currentGuess.length < 5) {
        currentGuess += e.key.toUpperCase();
      } else if(e.key === 'Enter') {
        submitGuess();
      }
      updateInputTiles();
      document.getElementById('hiddenInput').value = currentGuess;
    }
  </script>

  <div style="position: fixed; top: 10px; right: 10px; font-size: 12px; color: #888;">
    v1.0.7
  </div>
</body>
</html>