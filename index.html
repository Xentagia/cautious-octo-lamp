<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Custom Wordle League</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 400px;
      margin: 20px auto;
      text-align: center;
    }
    .input-row {
      display: flex;
      justify-content: center;
      margin: 15px 0;
      gap: 8px;
      cursor: pointer;
    }
    .tile {
      width: 48px;
      height: 48px;
      border: 2px solid #999;
      font-weight: bold;
      font-size: 2rem;
      line-height: 48px;
      text-transform: uppercase;
      user-select: none;
      border-radius: 5px;
      background-color: #eee;
    }
    .tile.green {
      background-color: #6aaa64;
      border-color: #6aaa64;
      color: white;
    }
    .tile.yellow {
      background-color: #c9b458;
      border-color: #c9b458;
      color: white;
    }
    .tile.grey {
      background-color: #787c7e;
      border-color: #787c7e;
      color: white;
    }
    #manualInput {
      font-size: 1.5rem;
      width: 270px;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      padding: 8px;
      border-radius: 5px;
      border: 2px solid #999;
      outline-offset: 2px;
      margin-bottom: 15px;
    }
    button {
      font-size: 1.2rem;
      padding: 8px 16px;
      border-radius: 5px;
      border: none;
      background-color: #6aaa64;
      color: white;
      cursor: pointer;
      user-select: none;
    }
    button:disabled {
      background-color: #a0a0a0;
      cursor: default;
    }
    #result {
      margin-top: 15px;
      min-height: 80px;
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <h1>Custom Wordle League</h1>
  <p>Type your 5-letter guess:</p>

  <div class="input-row" id="inputRow" tabindex="0" aria-label="Wordle input tiles">
    <div class="tile input-tile" id="tile0"></div>
    <div class="tile input-tile" id="tile1"></div>
    <div class="tile input-tile" id="tile2"></div>
    <div class="tile input-tile" id="tile3"></div>
    <div class="tile input-tile" id="tile4"></div>
  </div>

  <input
    id="manualInput"
    maxlength="5"
    placeholder="Tap here to type"
    autocomplete="off"
    autocorrect="off"
    autocapitalize="characters"
    spellcheck="false"
  />

  <button onclick="submitGuess()">Guess</button>

  <div id="result"></div>

  <input
    id="hiddenInput"
    style="width:1px; height:1px; position:fixed; top:0; left:0; opacity:0.1;"
    autocomplete="off"
    autocorrect="off"
    autocapitalize="characters"
    spellcheck="false"
  />

  <script>
    const wordList = [
      "apple",
      "brave",
      "charm",
      "delta",
      "eagle",
      "fancy",
      "grape",
      "hound",
      "mango",
    ];
    const startDate = new Date("2025-06-01");
    const today = new Date();
    const dayNumber = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
    const targetWord = wordList[dayNumber % wordList.length].toUpperCase();
    const maxGuesses = 6;
    const guesses = [];
    let currentGuess = "";

    // Show guess pattern squares with correct coloring
    function colorGuess(guess) {
      let result = "";
      const target = targetWord.split("");
      const guessArr = guess.split("");
      const colors = Array(5).fill("grey");

      // First pass: mark greens
      for (let i = 0; i < 5; i++) {
        if (guessArr[i] === target[i]) {
          colors[i] = "green";
          target[i] = null; // remove matched letter
          guessArr[i] = null; // mark matched letter
        }
      }

      // Second pass: mark yellows
      for (let i = 0; i < 5; i++) {
        if (guessArr[i]) {
          const idx = target.indexOf(guessArr[i]);
          if (idx !== -1) {
            colors[i] = "yellow";
            target[idx] = null; // remove matched letter
          }
        }
      }

      // Build display string with colored tiles & letters
      for (let i = 0; i < 5; i++) {
        const c = guess[i];
        const color = colors[i];
        result += `<span class="tile ${color}">${c}</span>`;
      }
      return result;
    }

    function submitGuess() {
      if (currentGuess.length !== 5) {
        alert("Please enter a 5-letter word.");
        return;
      }
      if (guesses.includes(currentGuess)) {
        alert("You already guessed that word.");
        return;
      }
      guesses.push(currentGuess);

      const colored = colorGuess(currentGuess);
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML += colored + "<br>";

      if (currentGuess === targetWord) {
        resultDiv.innerHTML += "<br><strong>ðŸŽ‰ You guessed the word! ðŸŽ‰</strong><br>";
        endGame();
      } else if (guesses.length >= maxGuesses) {
        resultDiv.innerHTML += `<br><strong>Game over! The word was ${targetWord}.</strong><br>`;
        endGame();
      } else {
        clearInput();
      }
    }

    function clearInput() {
      currentGuess = "";
      manualInput.value = "";
      hiddenInput.value = "";
      for (let i = 0; i < 5; i++) {
        document.getElementById("tile" + i).textContent = "";
      }
      manualInput.focus();
    }

    function endGame() {
      document.querySelector("button").disabled = true;
      manualInput.disabled = true;
      hiddenInput.disabled = true;
      document.removeEventListener("keydown", handleKeyPress);
      localStorage.setItem("wordlePlayed-" + dayNumber, "true");
      localStorage.setItem("wordleResult-" + dayNumber, document.getElementById("result").innerHTML);
    }

    // Sync manualInput changes to tiles and currentGuess
    const manualInput = document.getElementById("manualInput");
    const hiddenInput = document.getElementById("hiddenInput");

    manualInput.addEventListener("input", (e) => {
      let val = e.target.value.toUpperCase().slice(0, 5);
      e.target.value = val;

      for (let i = 0; i < 5; i++) {
        document.getElementById("tile" + i).textContent = val[i] || "";
      }

      currentGuess = val;
    });

    manualInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        submitGuess();
      }
    });

    hiddenInput.addEventListener("input", (e) => {
      let val = e.target.value.toUpperCase().slice(0, 5);
      e.target.value = val;

      for (let i = 0; i < 5; i++) {
        document.getElementById("tile" + i).textContent = val[i] || "";
      }

      currentGuess = val;
    });

    hiddenInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        submitGuess();
      }
    });

    // On clicking tiles, focus the manual input so keyboard shows on mobile
    document.getElementById("inputRow").addEventListener("click", () => {
      manualInput.focus();
    });

    // On page load, check if already played and restore result or reset
    window.onload = function () {
      const played = localStorage.getItem("wordlePlayed-" + dayNumber);
      const savedResult = localStorage.getItem("wordleResult-" + dayNumber);
      if (played && savedResult) {
        document.getElementById("result").innerHTML = savedResult;
        document.querySelector("button").disabled = true;
        manualInput.disabled = true;
        hiddenInput.disabled = true;
      } else {
        clearInput();
        manualInput.focus();
      }
    };
  </script>

  <div style="position: fixed; top: 10px; right: 10px; font-size: 12px; color: #888;">
    v1.0.5
  </div>
</body>
</html>